"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1071],{1071:function(e,t,n){n.d(t,{Fg:function(){return f},Nb:function(){return l},cO:function(){return d},ec:function(){return m},t2:function(){return u}});var i=n(29827),r=n(11713),a=n(21770),s=n(96629),o=n(23340),c=n(97160);function u(){var e;let{toast:t}=(0,o.pm)();(0,i.NL)();let n=(0,c.o)(e=>e.setExpenses),a=(0,r.a)({queryKey:["expenses"],queryFn:async()=>{let e=(await (0,s.T4)()).map(e=>{var t,n,i,r;return{id:e.id,description:e.description||"",amount:null!==(t=e.amount)&&void 0!==t?t:0,category:e.category||"",category_id:e.category_id||"",category_name:e.category_name||"",date:e.date||"",date_incurred:e.date_incurred||"",payment_method:e.payment_method||"",vendor_name:e.vendor_name||"",receipt_number:e.receipt_number||"",receipt_url:e.receipt_url||"",is_business_expense:null!==(n=e.is_business_expense)&&void 0!==n&&n,is_reimbursable:null!==(i=e.is_reimbursable)&&void 0!==i&&i,tax_deductible:null!==(r=e.tax_deductible)&&void 0!==r&&r,notes:e.notes||"",tags:e.tags||[],status:e.status||"pending",created_at:e.created_at||"",updated_at:e.updated_at||""}});return n(e),e}});return{expenses:null!==(e=a.data)&&void 0!==e?e:[],isLoading:a.isLoading,error:a.error,refetch:a.refetch}}function l(e){return(0,r.a)({queryKey:["expense",e],queryFn:()=>(0,s.YD)(e),enabled:!!e})}function d(){let{toast:e}=(0,o.pm)(),t=(0,i.NL)(),n=(0,c.o)(e=>e.addExpense);return(0,a.D)({mutationFn:s.Fl,onSuccess:i=>{var r,a;n({...i,category_id:i.category_id||"",category_name:i.category_name||"",date_incurred:i.date_incurred||"",payment_method:i.payment_method||"",vendor_name:i.vendor_name||"",receipt_number:i.receipt_number||"",is_business_expense:null!==(r=i.is_business_expense)&&void 0!==r&&r,tax_deductible:null!==(a=i.tax_deductible)&&void 0!==a&&a,notes:i.notes||"",tags:i.tags||[],created_at:i.created_at||"",updated_at:i.updated_at||""}),t.invalidateQueries({queryKey:["expenses"]}),t.invalidateQueries({queryKey:["balance"]}),e({title:"Success",description:"Expense created successfully"})},onError:t=>{e({title:"Error",description:t.message||"Failed to create expense",variant:"destructive"})}})}function f(){let{toast:e}=(0,o.pm)(),t=(0,i.NL)(),n=(0,c.o)(e=>e.updateExpense);return(0,a.D)({mutationFn:e=>{let{id:t,data:n}=e;return(0,s.E)(t,n)},onSuccess:i=>{n(i.id,i),t.invalidateQueries({queryKey:["expenses"]}),t.invalidateQueries({queryKey:["expense",i.id]}),t.invalidateQueries({queryKey:["balance"]}),e({title:"Success",description:"Expense updated successfully"})},onError:t=>{e({title:"Error",description:t.message||"Failed to update expense",variant:"destructive"})}})}function m(){let{toast:e}=(0,o.pm)(),t=(0,i.NL)(),n=(0,c.o)(e=>e.removeExpense);return(0,a.D)({mutationFn:s.vu,onSuccess:(i,r)=>{n(r),t.invalidateQueries({queryKey:["expenses"]}),t.invalidateQueries({queryKey:["balance"]}),e({title:"Success",description:"Expense deleted successfully"})},onError:t=>{e({title:"Error",description:t.message||"Failed to delete expense",variant:"destructive"})}})}},96629:function(e,t,n){n.d(t,{E:function(){return v},Eb:function(){return h},Fl:function(){return y},Gw:function(){return w},Nu:function(){return c},Qu:function(){return o},T4:function(){return p},VP:function(){return x},Wu:function(){return f},YD:function(){return g},ZL:function(){return r},d5:function(){return l},eI:function(){return s},rk:function(){return m},s3:function(){return a},sA:function(){return u},vu:function(){return _}});var i=n(5526);async function r(){let{data:e,error:t}=await i.OQ.from("clients").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async function a(e){let{data:t,error:n}=await i.OQ.from("clients").select("*").eq("id",e).single();if(n)throw n;return t}async function s(e){let{data:t,error:n}=await i.OQ.from("clients").insert([e]).select().single();if(n)throw n;return t}async function o(e,t){let{data:n,error:r}=await i.OQ.from("clients").update(t).eq("id",e).select().single();if(r)throw r;return n}async function c(e){let{error:t}=await i.OQ.from("clients").delete().eq("id",e);if(t)throw t}async function u(){let{data:e,error:t}=await i.OQ.from("invoices").select("\n      *,\n      clients (\n        id,\n        name,\n        email,\n        company\n      )\n    ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async function l(e){let{data:t,error:n}=await i.OQ.from("invoices").select("\n      *,\n      clients (\n        id,\n        name,\n        email,\n        company\n      )\n    ").eq("id",e).single();if(n)throw n;return t}async function d(e,t){let{data:n,error:r}=await i.OQ.from("invoices").update(t).eq("id",e).select().single();if(r)throw r;return n}async function f(e){let{error:t}=await i.OQ.from("invoices").delete().eq("id",e);if(t)throw t}async function m(e,t){return d(e,{status:t})}async function p(){let{data:e,error:t}=await i.OQ.from("expenses").select("*").order("date",{ascending:!1});if(t)throw t;return e||[]}async function g(e){let{data:t,error:n}=await i.OQ.from("expenses").select("*").eq("id",e).single();if(n)throw n;return t}async function y(e){let{data:t,error:n}=await i.OQ.from("expenses").insert([e]).select().single();if(n)throw n;return t}async function v(e,t){let{data:n,error:r}=await i.OQ.from("expenses").update(t).eq("id",e).select().single();if(r)throw r;return n}async function _(e){let{error:t}=await i.OQ.from("expenses").delete().eq("id",e);if(t)throw t}async function w(){let{data:{user:e}}=await i.OQ.auth.getUser();if(!e)return null;let{data:t,error:n}=await i.OQ.from("settings").select("*").eq("user_id",e.id).single();if(n&&"PGRST116"!==n.code)throw n;return t||null}async function x(e){let{data:{user:t}}=await i.OQ.auth.getUser();if(!t)throw Error("User not authenticated");let{data:n,error:r}=await i.OQ.from("settings").upsert({...e,user_id:t.id}).select().single();if(r)throw r;return n}async function h(){try{let[e,t,n]=await Promise.all([i.OQ.from("invoices").select("\n        *,\n        clients (\n          id,\n          name,\n          email,\n          company\n        )\n      "),i.OQ.from("clients").select("*"),i.OQ.from("expenses").select("*")]),r=e.data||[],a=t.data||[],s=n.data||[],o=r.filter(e=>"Paid"===e.status).reduce((e,t)=>e+t.amount,0),c=s.reduce((e,t)=>e+t.amount,0),u=function(e){let t=new Map;return e.filter(e=>"Paid"===e.status).forEach(e=>{let n=new Date(e.created_at);"".concat(n.getFullYear(),"-").concat((n.getMonth()+1).toString().padStart(2,"0"));let i=n.toLocaleDateString("en-US",{year:"numeric",month:"short"});t.set(i,(t.get(i)||0)+e.amount)}),Array.from(t.entries()).map(e=>{let[t,n]=e;return{month:t,revenue:n}})}(r),l=function(e){let t=new Map;return e.forEach(e=>{let n=e.category||"Uncategorized";t.set(n,(t.get(n)||0)+e.amount)}),Array.from(t.entries()).map(e=>{let[t,n]=e;return{category:t,amount:n}})}(s),d=function(e){let t=new Map;return e.filter(e=>"Paid"===e.status).forEach(e=>{var n;let i=(null===(n=e.clients)||void 0===n?void 0:n.name)||"Unknown Client";t.set(i,(t.get(i)||0)+e.amount)}),Array.from(t.entries()).map(e=>{let[t,n]=e;return{client:t,revenue:n}}).sort((e,t)=>t.revenue-e.revenue).slice(0,10)}(r),f=function(e){let t=new Map;return e.forEach(e=>{let n=e.status||"Unknown";t.set(n,(t.get(n)||0)+1)}),Array.from(t.entries()).map(e=>{let[t,n]=e;return{status:t,count:n}})}(r);return{totalRevenue:o,totalExpenses:c,totalClients:a.length,totalInvoices:r.length,monthlyRevenue:u,expensesByCategory:l,clientRevenue:d,invoiceStatusDistribution:f}}catch(e){throw console.error("Error fetching analytics data:",e),e}}},97160:function(e,t,n){n.d(t,{o:function(){return a}});var i=n(59625),r=n(5526);let a=(0,i.Ue)((e,t)=>({user:null,clients:[],invoices:[],expenses:[],expenseCategories:[],settings:null,balanceSummary:null,isLoading:!1,isLoadingClients:!1,isLoadingInvoices:!1,isLoadingExpenses:!1,setUser:t=>e({user:t}),setLoading:t=>e({isLoading:t}),setClients:t=>e({clients:t}),setInvoices:t=>e({invoices:t}),setExpenses:t=>e({expenses:t}),setSettings:t=>e({settings:t}),setBalanceSummary:t=>e({balanceSummary:t}),loadInitialData:async()=>{e({isLoading:!0});try{let[n,i,a,s,o]=await Promise.all([r.TW.getClients(),r.TW.getInvoices(),r.TW.getExpenses(),r.TW.getExpenseCategories(),r.TW.getBalanceSummary()]);n.data&&e({clients:n.data}),i.data&&e({invoices:i.data}),a.data&&e({expenses:a.data}),s.data&&e({expenseCategories:s.data}),o.data&&e({balanceSummary:o.data});let{user:c}=t();if(c){let t=await r.TW.getSettings(c.id);t.data&&e({settings:t.data})}}catch(e){console.error("Error loading initial data:",e)}finally{e({isLoading:!1})}},addClient:t=>e(e=>({clients:[t,...e.clients]})),updateClient:(t,n)=>e(e=>({clients:e.clients.map(e=>e.id===t?{...e,...n}:e)})),removeClient:t=>e(e=>({clients:e.clients.filter(e=>e.id!==t)})),addInvoice:t=>e(e=>({invoices:[t,...e.invoices]})),updateInvoice:(t,n)=>e(e=>({invoices:e.invoices.map(e=>e.id===t?{...e,...n}:e)})),removeInvoice:t=>e(e=>({invoices:e.invoices.filter(e=>e.id!==t)})),addExpense:t=>e(e=>({expenses:[t,...e.expenses]})),updateExpense:(t,n)=>e(e=>({expenses:e.expenses.map(e=>e.id===t?{...e,...n}:e)})),removeExpense:t=>e(e=>({expenses:e.expenses.filter(e=>e.id!==t)})),updateSettings:t=>e(e=>({settings:e.settings?{...e.settings,...t}:null})),updateBalanceSummary:t=>e(e=>({balanceSummary:e.balanceSummary?{...e.balanceSummary,...t}:null})),getTotalEarnings:()=>{let{invoices:e}=t();return e.filter(e=>"Paid"===e.status).reduce((e,t)=>e+t.amount,0)},getTotalExpenses:()=>{let{expenses:e}=t();return e.reduce((e,t)=>e+t.amount,0)},getCurrentBalance:()=>{let{getTotalEarnings:e,getTotalExpenses:n}=t();return e()-n()},getRecentInvoices:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,{invoices:n}=t();return n.slice().sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,e)},getRecentExpenses:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,{expenses:n}=t();return n.slice().sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,e)},getOverdueInvoices:()=>{let{invoices:e}=t(),n=new Date;return e.filter(e=>"Pending"===e.status&&new Date(e.due_date)<n)},reset:()=>e({user:null,clients:[],invoices:[],expenses:[],expenseCategories:[],settings:null,balanceSummary:null,isLoading:!1,isLoadingClients:!1,isLoadingInvoices:!1,isLoadingExpenses:!1})}))}}]);